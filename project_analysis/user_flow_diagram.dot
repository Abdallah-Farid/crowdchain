digraph CrowdChain {
    // Graph settings
    rankdir=TB;
    fontname="Arial";
    fontsize=16;
    label="CrowdChain User Flow Diagram";
    labelloc="t";
    
    // Node styles
    node [shape=box, style="rounded,filled", fillcolor=lightblue, fontname="Arial", fontsize=12, margin=0.2];
    edge [fontname="Arial", fontsize=10];
    
    // Start node
    start [label="Start", shape=oval, fillcolor=lightgreen];
    
    // Common nodes
    register [label="Register/Login\nwith Wallet Connection"];
    browse_projects [label="Browse/Search\nProjects"];
    view_project_details [label="View Project\nDetails"];
    
    // Subgraph for Visitor flow
    subgraph cluster_visitor {
        label="Visitor Journey";
        style=filled;
        color=lightgrey;
        
        visitor_browse [label="Browse Projects\nas Visitor"];
        visitor_view_details [label="View Project\nDetails"];
        visitor_decision [label="Decision", shape=diamond, fillcolor=lightyellow];
    }
    
    // Subgraph for Project Creator flow
    subgraph cluster_creator {
        label="Project Creator Journey";
        style=filled;
        color=lightblue;
        
        create_project [label="Create New Project"];
        add_project_details [label="Add Project Details\n(Title, Description, Images)"];
        set_funding_goal [label="Set Funding Goal"];
        add_milestones [label="Add Project Milestones\n(New Feature)"];
        publish_project [label="Publish Project"];
        monitor_project [label="Monitor Project\nProgress"];
        update_project [label="Post Project\nUpdates"];
        request_milestone_approval [label="Request Milestone\nCompletion Approval\n(New Feature)"];
        receive_funds [label="Receive Funds\nUpon Milestone Approval\n(New Feature)"];
        complete_project [label="Complete Project"];
    }
    
    // Subgraph for Backer flow
    subgraph cluster_backer {
        label="Backer Journey";
        style=filled;
        color=lightpink;
        
        back_project [label="Back Project with\nCryptocurrency"];
        track_backed_projects [label="Track Backed\nProjects"];
        receive_updates [label="Receive Project\nUpdates"];
        vote_on_milestone [label="Vote on Milestone\nCompletion\n(New Feature)"];
        view_transaction_history [label="View Transaction\nHistory"];
    }
    
    // Connections
    start -> register;
    start -> browse_projects;
    
    // Visitor flow
    browse_projects -> visitor_browse [style=dashed];
    visitor_browse -> visitor_view_details;
    visitor_view_details -> visitor_decision;
    visitor_decision -> register [label="Want to participate"];
    visitor_decision -> visitor_browse [label="Continue browsing"];
    
    // Common registered user paths
    register -> browse_projects;
    register -> create_project;
    browse_projects -> view_project_details;
    
    // Project Creator flow
    create_project -> add_project_details;
    add_project_details -> set_funding_goal;
    set_funding_goal -> add_milestones;
    add_milestones -> publish_project;
    publish_project -> monitor_project;
    monitor_project -> update_project;
    update_project -> monitor_project;
    monitor_project -> request_milestone_approval;
    request_milestone_approval -> receive_funds;
    receive_funds -> monitor_project;
    monitor_project -> complete_project;
    
    // Backer flow
    view_project_details -> back_project;
    back_project -> track_backed_projects;
    track_backed_projects -> receive_updates;
    receive_updates -> track_backed_projects;
    track_backed_projects -> vote_on_milestone;
    vote_on_milestone -> track_backed_projects;
    track_backed_projects -> view_transaction_history;
    
    // Cross-role interactions
    update_project -> receive_updates [style=dotted, color=red, label="Notifies"];
    request_milestone_approval -> vote_on_milestone [style=dotted, color=red, label="Triggers"];
    vote_on_milestone -> receive_funds [style=dotted, color=red, label="Enables if approved"];
    
    // Legend
    subgraph cluster_legend {
        label="Legend";
        style=filled;
        color=white;
        
        legend_normal [label="Normal Flow", shape=box];
        legend_new [label="New Feature", shape=box, color=darkgreen, penwidth=2.0];
        legend_notification [label="Notification/Trigger", shape=box, style="dotted,filled"];
        
        legend_normal -> legend_new [style=invis];
        legend_new -> legend_notification [style=invis];
    }
}
